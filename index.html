<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lotte Mart - Promo Data Entry</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
  <style>
    :root {
      --lotte-red: #CC0000;
      --lotte-red-dark: #990000;
      --bg: #F7F7F8;
      --surface: #FFFFFF;
      --text-primary: #1A1A2E;
      --text-secondary: #6B7280;
      --text-muted: #9CA3AF;
      --border: #E5E7EB;
      --border-focus: #CC0000;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.06);
      --shadow-lg: 0 8px 24px rgba(0,0,0,0.08);
      --radius: 12px;
      --radius-sm: 8px;
      --transition: 0.2s cubic-bezier(0.4,0,0.2,1);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Plus Jakarta Sans',-apple-system,sans-serif; background:var(--bg); color:var(--text-primary); min-height:100vh; }

    /* Header */
    .header { background:var(--lotte-red); position:sticky; top:0; z-index:100; box-shadow:0 2px 12px rgba(204,0,0,0.3); }
    .header-inner { max-width:900px; margin:0 auto; padding:16px 24px; display:flex; align-items:center; justify-content:space-between; }
    .header-brand { display:flex; align-items:center; gap:14px; }
    .logo-circle { width:42px; height:42px; background:rgba(255,255,255,0.15); border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:22px; font-weight:800; color:#fff; backdrop-filter:blur(10px); }
    .brand-text h1 { font-size:18px; font-weight:700; color:#fff; }
    .brand-text span { font-size:11px; color:rgba(255,255,255,0.7); font-weight:500; }
    .store-badge { background:rgba(255,255,255,0.2); color:#fff; padding:8px 22px; border-radius:20px; font-size:14px; font-weight:700; letter-spacing:1.5px; border:1px solid rgba(255,255,255,0.2); }

    /* Container */
    .container { max-width:900px; margin:0 auto; padding:28px 24px 80px; }

    /* Section */
    .section { background:var(--surface); border-radius:var(--radius); padding:24px; margin-bottom:20px; box-shadow:var(--shadow-sm); border:1px solid var(--border); transition:box-shadow var(--transition); }
    .section:hover { box-shadow:var(--shadow-md); }
    .section-title { font-size:13px; font-weight:700; color:var(--text-secondary); text-transform:uppercase; letter-spacing:1.2px; margin-bottom:18px; display:flex; align-items:center; gap:8px; }
    .section-title .material-icons-outlined { font-size:18px; color:var(--lotte-red); }

    /* Form */
    .form-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
    .form-group { display:flex; flex-direction:column; gap:6px; }
    .form-group label { font-size:12px; font-weight:600; color:var(--text-secondary); }
    .form-group select, .form-group input[type="text"] {
      padding:10px 14px; border:1.5px solid var(--border); border-radius:var(--radius-sm);
      font-size:14px; font-family:inherit; font-weight:500; color:var(--text-primary);
      background:var(--surface); transition:all var(--transition); outline:none;
      appearance:none; -webkit-appearance:none;
    }
    .form-group select {
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%236B7280' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
      background-repeat:no-repeat; background-position:right 12px center; padding-right:36px; cursor:pointer;
    }
    .form-group select:focus, .form-group input:focus { border-color:var(--border-focus); box-shadow:0 0 0 3px rgba(204,0,0,0.08); }
    .form-group select:disabled, .form-group input:disabled { background:#F3F4F6; color:var(--text-muted); cursor:not-allowed; }

    /* Upload */
    .upload-area { border:2px dashed var(--border); border-radius:var(--radius); padding:28px; text-align:center; cursor:pointer; transition:all var(--transition); background:#FAFBFC; position:relative; overflow:hidden; }
    .upload-area:hover { border-color:var(--lotte-red); background:#FFF5F5; }
    .upload-area.has-image { padding:10px; border-style:solid; border-color:var(--lotte-red); background:#fff; }
    .upload-icon { font-size:36px; color:var(--text-muted); margin-bottom:8px; }
    .upload-text { font-size:13px; color:var(--text-secondary); font-weight:500; }
    .upload-hint { font-size:11px; color:var(--text-muted); margin-top:4px; }
    .upload-area img { max-width:100%; max-height:180px; border-radius:var(--radius-sm); object-fit:contain; }
    .upload-area .remove-btn { position:absolute; top:8px; right:8px; width:28px; height:28px; background:var(--lotte-red); color:#fff; border:none; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:16px; opacity:0; transition:opacity var(--transition); }
    .upload-area:hover .remove-btn { opacity:1; }
    #imageInput { display:none; }

    /* Buttons */
    .submit-section { display:flex; align-items:center; gap:16px; justify-content:space-between; }
    .btn-submit { background:var(--lotte-red); color:#fff; border:none; padding:14px 40px; border-radius:var(--radius-sm); font-size:15px; font-weight:700; font-family:inherit; cursor:pointer; transition:all var(--transition); display:flex; align-items:center; gap:8px; }
    .btn-submit:hover { background:var(--lotte-red-dark); transform:translateY(-1px); box-shadow:0 4px 16px rgba(204,0,0,0.3); }
    .btn-submit:active { transform:translateY(0); }
    .btn-submit:disabled { background:#D1D5DB; cursor:not-allowed; transform:none; box-shadow:none; }
    .btn-reset { background:none; border:1.5px solid var(--border); color:var(--text-secondary); padding:14px 24px; border-radius:var(--radius-sm); font-size:14px; font-weight:600; font-family:inherit; cursor:pointer; transition:all var(--transition); }
    .btn-reset:hover { border-color:var(--text-secondary); background:#F9FAFB; }

    /* Division indicator */
    .division-indicator { width:100%; height:4px; border-radius:2px; margin-top:12px; transition:background var(--transition); background:var(--border); }

    /* Toast */
    .toast { position:fixed; bottom:24px; right:24px; padding:14px 24px; border-radius:var(--radius-sm); font-size:14px; font-weight:600; color:#fff; z-index:1000; transform:translateY(100px); opacity:0; transition:all 0.35s cubic-bezier(0.4,0,0.2,1); display:flex; align-items:center; gap:10px; box-shadow:var(--shadow-lg); max-width:420px; }
    .toast.show { transform:translateY(0); opacity:1; }
    .toast.success { background:#059669; }
    .toast.error { background:#DC2626; }

    .spinner { width:18px; height:18px; border:2.5px solid rgba(255,255,255,0.3); border-top-color:#fff; border-radius:50%; animation:spin .7s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }

    /* History */
    .history-table { width:100%; border-collapse:separate; border-spacing:0; font-size:13px; }
    .history-table th { background:#F9FAFB; padding:10px 14px; text-align:left; font-weight:600; color:var(--text-secondary); font-size:11px; text-transform:uppercase; letter-spacing:.8px; border-bottom:1px solid var(--border); }
    .history-table td { padding:10px 14px; border-bottom:1px solid var(--border); }
    .history-table tr:last-child td { border-bottom:none; }
    .div-dot { width:10px; height:10px; border-radius:50%; display:inline-block; margin-right:6px; vertical-align:middle; }
    .empty-state { text-align:center; padding:32px; color:var(--text-muted); font-size:13px; }
    .empty-state .material-icons-outlined { font-size:40px; margin-bottom:8px; opacity:.4; }

    @media (max-width:640px) {
      .container { padding:16px 12px 80px; }
      .form-grid { grid-template-columns:1fr; }
      .header-inner { padding:12px 16px; }
      .submit-section { flex-direction:column; }
      .btn-submit,.btn-reset { width:100%; justify-content:center; }
    }

    .fade-in { animation:fadeIn .4s ease-out; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
  </style>
</head>
<body>

<header class="header">
  <div class="header-inner">
    <div class="header-brand">
      <div class="logo-circle">L</div>
      <div class="brand-text">
        <h1>LOTTE MART</h1>
        <span>Promo Display Data Entry</span>
      </div>
    </div>
    <div class="store-badge" id="storeBadge"></div>
  </div>
</header>

<div class="container">

  <!-- Store -->
  <div class="section fade-in">
    <div class="section-title"><span class="material-icons-outlined">store</span>Lokasi Toko</div>
    <div class="form-grid">
      <div class="form-group">
        <label for="region">Region</label>
        <select id="region" onchange="onRegionChange()">
          <option value="">Pilih Region</option>
          <option value="Region 1">Region 1</option>
          <option value="Region 2">Region 2</option>
          <option value="Region 3">Region 3</option>
        </select>
      </div>
      <div class="form-group">
        <label for="storeName">Store Name</label>
        <select id="storeName" disabled><option value="">Pilih Region dulu</option></select>
      </div>
    </div>
  </div>

  <!-- Division & Category -->
  <div class="section fade-in" style="animation-delay:.05s">
    <div class="section-title"><span class="material-icons-outlined">category</span>Divisi & Kategori</div>
    <div class="form-grid">
      <div class="form-group">
        <label for="division">Division</label>
        <select id="division" onchange="onDivisionChange()"><option value="">Pilih Divisi</option></select>
      </div>
      <div class="form-group">
        <label for="category">Category</label>
        <select id="category" disabled><option value="">Pilih Divisi dulu</option></select>
      </div>
    </div>
    <div class="division-indicator" id="divisionIndicator"></div>
  </div>

  <!-- Product -->
  <div class="section fade-in" style="animation-delay:.1s">
    <div class="section-title"><span class="material-icons-outlined">inventory_2</span>Informasi Produk</div>
    <div class="form-grid">
      <div class="form-group">
        <label for="prodNm">Product Name</label>
        <input type="text" id="prodNm" placeholder="Nama produk">
      </div>
      <div class="form-group">
        <label for="stk">Stock (Stk)</label>
        <input type="text" id="stk" placeholder="Jumlah stok">
      </div>
    </div>
  </div>

  <!-- Image -->
  <div class="section fade-in" style="animation-delay:.15s">
    <div class="section-title"><span class="material-icons-outlined">image</span>Upload Gambar Produk</div>
    <div class="upload-area" id="uploadArea" onclick="document.getElementById('imageInput').click()">
      <div id="uploadPlaceholder">
        <div class="upload-icon material-icons-outlined">cloud_upload</div>
        <div class="upload-text">Klik atau drag gambar ke sini</div>
        <div class="upload-hint">PNG, JPG, WEBP — Maks. 5MB</div>
      </div>
      <img id="previewImg" style="display:none" />
      <button class="remove-btn" id="removeImgBtn" onclick="event.stopPropagation();removeImage();" style="display:none">✕</button>
    </div>
    <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)">
  </div>

  <!-- Submit -->
  <div class="section fade-in" style="animation-delay:.2s">
    <div class="submit-section">
      <button class="btn-reset" onclick="resetForm()">Reset Form</button>
      <button class="btn-submit" id="submitBtn" onclick="handleSubmit()">
        <span class="material-icons-outlined">send</span>Submit ke Slides
      </button>
    </div>
  </div>

  <!-- History -->
  <div class="section fade-in" style="animation-delay:.25s">
    <div class="section-title"><span class="material-icons-outlined">history</span>Riwayat Input Sesi Ini</div>
    <div id="historyContent">
      <div class="empty-state"><div class="material-icons-outlined">inbox</div><div>Belum ada data yang diinput</div></div>
    </div>
  </div>
</div>

<div class="toast" id="toast">
  <span class="material-icons-outlined" id="toastIcon">check_circle</span>
  <span id="toastMessage"></span>
</div>

<script>
// Store type injected from Apps Script template
const STORE_TYPE = '<?= storeType ?>';

const STORES = {
  LSI: {
    'Region 1': [
      {code:'6001',loc:'Pasar Rebo'},{code:'6003',loc:'Kelapa Gading'},
      {code:'6007',loc:'Alam Sutera'},{code:'6010',loc:'Medan'},
      {code:'6014',loc:'Palembang'},{code:'6015',loc:'Pekanbaru'},
      {code:'6021',loc:'Jatake'},{code:'6029',loc:'Batam'},
      {code:'6031',loc:'Lampung'},{code:'6006',loc:'Ciputat'},
      {code:'6022',loc:'Serang'},{code:'6039',loc:'Serpong'}
    ],
    'Region 2': [
      {code:'6004',loc:'Meruya'},{code:'6005',loc:'Bandung'},
      {code:'6008',loc:'Cibitung'},{code:'6023',loc:'Cikarang'},
      {code:'6024',loc:'Cirebon'},{code:'6027',loc:'Tasikmalaya'},
      {code:'6034',loc:'Karawang'},{code:'6036',loc:'Padalarang'},
      {code:'6038',loc:'Tegal'},{code:'6018',loc:'Bekasi'},
      {code:'6026',loc:'Bogor'},{code:'6030',loc:'Pakansari'},
      {code:'6002',loc:'Sidoarjo'}
    ],
    'Region 3': [
      {code:'6009',loc:'Denpasar'},{code:'6013',loc:'Makasar'},
      {code:'6017',loc:'Banjarmasin'},{code:'6020',loc:'Balikpapan'},
      {code:'6028',loc:'Mastrip'},{code:'6032',loc:'Samarinda'},
      {code:'6033',loc:'Manado'},{code:'6037',loc:'Mataram'},
      {code:'6011',loc:'Semarang'},{code:'6016',loc:'Yogyakarta'},
      {code:'6019',loc:'Solo'}
    ]
  },
  LMI: {
    'Region 1': [
      {code:'04003',loc:'FESTIVAL CITY LINK'},{code:'04004',loc:'KELAPA GADING'},
      {code:'04005',loc:'KUNINGAN CITY'},{code:'04009',loc:'TAMAN SURYA'},
      {code:'04010',loc:'MEDAN CENTRE POINT'},{code:'04021',loc:'GREEN PRAMUKA'}
    ],
    'Region 2': [
      {code:'04001',loc:'GANDARIA'},{code:'04006',loc:'BINTARO'},
      {code:'04007',loc:'PANAKUKANG'},{code:'04008',loc:'FATMAWATI'},
      {code:'04013',loc:'SOLO BARU'},{code:'04020',loc:'PAKUWON MALL SBY'}
    ],
    'Region 3': [
      {code:'04022',loc:'BALI BEER'}
    ]
  }
};

const DIVISIONS = ['Dry Food','Meal Solution','Fresh Food','H&B HOME CARE','Non Food'];
const DIV_COLORS = {'Dry Food':'#F29A24','Fresh Food':'#55AA55','Meal Solution':'#8C1A26','H&B HOME CARE':'#87B3E0','Non Food':'#4D6680'};
const CATEGORIES = {
  'Dry Food':[{c:'11',n:'Biscuit/Snacks'},{c:'17',n:'Bulk Product'},{c:'21',n:'Sauces&Spices'},{c:'23',n:'Drinks'},{c:'24',n:'Milk'}],
  'Meal Solution':[{c:'80',n:'BAKERY'},{c:'82',n:'Delica'}],
  'Fresh Food':[{c:'31',n:'Fish'},{c:'32',n:'Meat'},{c:'33',n:'Fruits'},{c:'34',n:'Vegetables'},{c:'35',n:'Dairy & Frozen'}],
  'H&B HOME CARE':[{c:'14',n:'Home Care'},{c:'19',n:'H&B'}],
  'Non Food':[{c:'86',n:'IT/GADGET'},{c:'87',n:'Small Appliance'},{c:'88',n:'BIG APPLIANCE'},{c:'ELC',n:'Electronic'},{c:'51',n:'Kitchen'},{c:'57',n:'Bathroom'},{c:'85',n:'DIY'},{c:'13',n:'Interior & Bedding'},{c:'62',n:'Textile'},{c:'71',n:'Stationary/Toys'}]
};

let imageBase64 = '';
let history = [];

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('storeBadge').textContent = STORE_TYPE;
  const ds = document.getElementById('division');
  DIVISIONS.forEach(d => { const o = document.createElement('option'); o.value=d; o.textContent=d; ds.appendChild(o); });
});

function onRegionChange() {
  const r = document.getElementById('region').value;
  const s = document.getElementById('storeName');
  s.innerHTML = '<option value="">Pilih Store</option>';
  s.disabled = !r;
  if (!r) return;
  (STORES[STORE_TYPE][r]||[]).forEach(st => {
    const o = document.createElement('option');
    o.value = st.code+' - '+st.loc;
    o.textContent = st.code+' - '+st.loc;
    s.appendChild(o);
  });
}

function onDivisionChange() {
  const d = document.getElementById('division').value;
  const c = document.getElementById('category');
  c.innerHTML = '<option value="">Pilih Category</option>';
  c.disabled = !d;
  document.getElementById('divisionIndicator').style.background = d ? (DIV_COLORS[d]||'var(--border)') : 'var(--border)';
  if (!d) return;
  (CATEGORIES[d]||[]).forEach(cat => {
    const o = document.createElement('option');
    o.value = cat.c+' - '+cat.n;
    o.textContent = cat.c+' - '+cat.n;
    c.appendChild(o);
  });
}

function handleImageUpload(e) {
  const f = e.target.files[0];
  if (!f) return;
  if (f.size > 5*1024*1024) { showToast('File melebihi 5MB!','error'); return; }
  const r = new FileReader();
  r.onload = ev => {
    imageBase64 = ev.target.result.split(',')[1];
    document.getElementById('previewImg').src = ev.target.result;
    document.getElementById('previewImg').style.display = 'block';
    document.getElementById('uploadPlaceholder').style.display = 'none';
    document.getElementById('removeImgBtn').style.display = 'flex';
    document.getElementById('uploadArea').classList.add('has-image');
  };
  r.readAsDataURL(f);
}

function removeImage() {
  imageBase64 = '';
  document.getElementById('previewImg').style.display = 'none';
  document.getElementById('previewImg').src = '';
  document.getElementById('uploadPlaceholder').style.display = 'block';
  document.getElementById('removeImgBtn').style.display = 'none';
  document.getElementById('uploadArea').classList.remove('has-image');
  document.getElementById('imageInput').value = '';
}

const ua = document.getElementById('uploadArea');
ua.addEventListener('dragover', e => { e.preventDefault(); ua.style.borderColor='var(--lotte-red)'; });
ua.addEventListener('dragleave', () => { if(!imageBase64) ua.style.borderColor=''; });
ua.addEventListener('drop', e => {
  e.preventDefault(); ua.style.borderColor='';
  const f = e.dataTransfer.files[0];
  if (f&&f.type.startsWith('image/')) {
    const inp = document.getElementById('imageInput');
    const dt = new DataTransfer(); dt.items.add(f); inp.files=dt.files;
    handleImageUpload({target:inp});
  }
});

function validate() {
  for (const id of ['region','storeName','division','category','prodNm','stk']) {
    if (!document.getElementById(id).value.trim()) {
      showToast('Mohon isi "'+document.querySelector('label[for="'+id+'"]').textContent+'"','error');
      document.getElementById(id).focus();
      return false;
    }
  }
  return true;
}

function handleSubmit() {
  if (!validate()) return;
  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.innerHTML = '<div class="spinner"></div> Submitting...';

  const data = {
    storeType: STORE_TYPE,
    region: document.getElementById('region').value,
    storeName: document.getElementById('storeName').value,
    division: document.getElementById('division').value,
    category: document.getElementById('category').value,
    prodNm: document.getElementById('prodNm').value.trim(),
    stk: document.getElementById('stk').value.trim(),
    imageBase64: imageBase64
  };

  google.script.run
    .withSuccessHandler(onOk)
    .withFailureHandler(onErr)
    .submitProductWithImage(data);
}

function onOk(r) {
  const btn = document.getElementById('submitBtn');
  btn.disabled = false;
  btn.innerHTML = '<span class="material-icons-outlined">send</span>Submit ke Slides';
  if (r.success) {
    showToast(r.message,'success');
    addHistory();
    document.getElementById('prodNm').value = '';
    document.getElementById('stk').value = '';
    removeImage();
  } else showToast(r.message,'error');
}

function onErr(e) {
  const btn = document.getElementById('submitBtn');
  btn.disabled = false;
  btn.innerHTML = '<span class="material-icons-outlined">send</span>Submit ke Slides';
  showToast('Error: '+e.message,'error');
}

function addHistory() {
  history.unshift({
    time: new Date().toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'}),
    store: document.getElementById('storeName').value,
    division: document.getElementById('division').value,
    prodNm: document.getElementById('prodNm').value,
    stk: document.getElementById('stk').value
  });
  renderHistory();
}

function renderHistory() {
  const c = document.getElementById('historyContent');
  if (!history.length) { c.innerHTML='<div class="empty-state"><div class="material-icons-outlined">inbox</div><div>Belum ada data</div></div>'; return; }
  let h='<table class="history-table"><thead><tr><th>Waktu</th><th>Toko</th><th>Divisi</th><th>Produk</th><th>Stk</th></tr></thead><tbody>';
  history.forEach(r => {
    h+='<tr><td>'+r.time+'</td><td>'+(r.store.split(' - ')[1]||r.store)+'</td><td><span class="div-dot" style="background:'+(DIV_COLORS[r.division]||'#999')+'"></span>'+r.division+'</td><td>'+r.prodNm+'</td><td>'+r.stk+'</td></tr>';
  });
  c.innerHTML = h+'</tbody></table>';
}

function resetForm() {
  document.getElementById('region').value='';
  document.getElementById('storeName').innerHTML='<option value="">Pilih Region dulu</option>';
  document.getElementById('storeName').disabled=true;
  document.getElementById('division').value='';
  document.getElementById('category').innerHTML='<option value="">Pilih Divisi dulu</option>';
  document.getElementById('category').disabled=true;
  document.getElementById('prodNm').value='';
  document.getElementById('stk').value='';
  document.getElementById('divisionIndicator').style.background='var(--border)';
  removeImage();
}

function showToast(msg,type) {
  const t=document.getElementById('toast');
  t.className='toast '+type;
  document.getElementById('toastMessage').textContent=msg;
  document.getElementById('toastIcon').textContent=type==='success'?'check_circle':'error';
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),3500);
}
</script>
</body>
</html>
